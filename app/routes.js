// =============================================================================
// Path handling module ========================================================
// =============================================================================
const path = require('path');

const fileUpload = require('express-fileupload');

const bodyParser = require('body-parser');

module.exports = function(app, express, handlers) {

    // =========================================================================
    // HOME PAGE ===============================================================
    // =========================================================================
    app.get('/', handlers.verifyToken, (req, res) => {
        if (req.decoded)
            res.sendFile(path.join(__dirname,'../www/index.html'));
        else
            res.redirect('/login');
    });

    // =========================================================================
    // REGISTER ================================================================
    // =========================================================================
    app.post('/register', handlers.registerMiddleware);
    
    // =========================================================================
    // LOGIN ===================================================================
    // =========================================================================
    app.post('/login', handlers.verifyToken, handlers.loginMiddleware);

    // =========================================================================
    // LOGOUT ==================================================================
    // =========================================================================
    app.post('/logout', handlers.verifyToken, handlers.logoutMiddleware);

    // =========================================================================
    // REGISTER PAGE ===========================================================
    // =========================================================================
    app.get(['/register', '/register.html'], handlers.verifyToken, (req, res) => {
        if (req.decoded)
            res.redirect('/');
        else
            res.sendFile(path.join(__dirname, '../www/register.html'));
    });

    // =========================================================================
    // LOGIN PAGE ==============================================================
    // =========================================================================
    app.get(['/login', '/login.html'], handlers.verifyToken, (req, res) => {
        if (req.decoded)
            res.redirect('/');
        else
            res.sendFile(path.join(__dirname, '../www/login.html'));
    });

    // =========================================================================
    // NFC/NDEF READER PAGE ====================================================
    // =========================================================================
    app.get(['/nfc', '/nfc.html'], handlers.verifyToken, (req, res) => {
        if (req.decoded)
            res.sendFile(path.join(__dirname, '../www/nfc.html'));
        else
            res.redirect('/');
    });

    // =========================================================================
    // MORE PAGE ===============================================================
    // =========================================================================
    app.get(['/vec', '/vec.html'], handlers.verifyToken, (req, res) => {
        if (req.decoded)
            res.sendFile(path.join(__dirname, '../www/vec.html'));
        else
            res.redirect('/');
    });

    // =========================================================================
    // SEND FORM DATA ==========================================================
    // =========================================================================
    app.post('/formdata', handlers.verifyToken, handlers.persistData);

    // =========================================================================
    // SEND XML ================================================================
    // =========================================================================
    app.post('/xmls', handlers.verifyToken, handlers.persistXML);

    // =========================================================================
    // RETRIEVE XMLS ===========================================================
    // =========================================================================
    app.get('/xmls', handlers.verifyToken, handlers.retrieveXML);

    // =========================================================================
    // RETRIEVE XML DOCUMENT ===================================================
    // =========================================================================
    app.get('/xmls/:id', handlers.verifyToken, handlers.retrieveXMLDocument);

    // =========================================================================
    // DELETE XML DOCUMENT =====================================================
    // =========================================================================
    app.delete('/xmls/:id', handlers.verifyToken, handlers.deleteXML);
    
    // =========================================================================
    // STATIC CONTENT ==========================================================
    // =========================================================================
    app.use('/css',    express.static('www/css'));
    app.use('/img',    express.static('www/img'));
    app.use('/js',     express.static('www/js'));
    app.use('/vendor', express.static('www/vendor'));

};