// =============================================================================
// Cookie parser, file upload and body parser ==================================
// =============================================================================
const cookieParser = require('cookie-parser');
const bodyParser   = require('body-parser');

// =============================================================================
// Handlebars view engine, Session manager and file upload for Express =========
// =============================================================================
const exphbs = require('express-handlebars');
const session = require('express-session');
const fileUpload = require('express-fileupload');

// =============================================================================
// Filesystem module ===========================================================
// =============================================================================
const fs = require("fs");

// =============================================================================
// Path handling module ========================================================
// =============================================================================
const path = require('path');

// =============================================================================
// Sequelize models ============================================================
// =============================================================================
const Racun = require('../models/Racun.js');
const Uporabnik = require('../models/Uporabnik.js');

// =============================================================================
// Cryptography module =========================================================
// =============================================================================
const crypto = require('crypto');

// =============================================================================
// Universally unique identifier generator module and secret ===================
// =============================================================================
const uuidv5 = require('uuid/v5');
const NAMESPACE_UUID = 'e36a80cb-7780-4b62-afbf-e684dc24419a';

module.exports = (app, express, db) => {
    
    // =========================================================================
    // BODY PARSER =============================================================
    // =========================================================================
    app.use(bodyParser.urlencoded({ extended: true }));
    app.use(bodyParser.json());

    // =========================================================================
    // SESSION =================================================================
    // =========================================================================
    app.use(
        session(
            { 
                secret: 'skrivni kljuc',
                resave: true, 
                saveUninitialized:true
            }
        )
    );

    // =========================================================================
    // FILE UPLOAD =============================================================
    // =========================================================================
    app.use(fileUpload());

    // =========================================================================
    // JSON HANDLER ============================================================
    // =========================================================================
    app.use(express.json());

    // =========================================================================
    // URLENCODED HANDLER ======================================================
    // =========================================================================
    app.use(express.urlencoded({extended: true}));

    // =========================================================================
    // COOKIE PARSER ===========================================================
    // =========================================================================
    app.use(cookieParser());

    // =========================================================================
    // HANDLEBARS VIEW ENGINE ==================================================
    // =========================================================================
    app.engine('handlebars', exphbs());
    app.set('view engine', 'handlebars');


    // =========================================================================
    // SERIALIZE USER ==========================================================
    // =========================================================================
    function serializeUser(uporabnik, done) {

    };

    // =========================================================================
    // DESERIALIZE USER ========================================================
    // =========================================================================
    function deserializeUser(id, done) {
        Uporabnik.findOne({
            where: { id: id }
        }).then( (uporabnik) => {
            console.log("FOUND??");
            console.log(uporabnik.dataValues);
            }
        )
    }
};